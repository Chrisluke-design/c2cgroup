<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>St Mary's Voice Math Duel</title>
    <style>
        :root {
            --school-blue: #003366;
            --school-gold: #f1c40f;
            --p1-color: #2ecc71;
            --p2-color: #3498db;
            --danger: #e74c3c;
            --light: #f4f7f6;
        }

        body {
            font-family: 'Segoe UI', sans-serif;
            background: linear-gradient(135deg, #003366, #00509d);
            display: flex;
            justify-content: center;
            align-items: center;
            min-height: 100vh;
            margin: 0;
            color: #2c3e50;
        }

        .game-container {
            background: white;
            padding: 30px;
            border-radius: 20px;
            box-shadow: 0 20px 50px rgba(0,0,0,0.4);
            width: 95%;
            max-width: 700px;
            text-align: center;
            border: 6px solid var(--school-gold);
        }

        .header h1 { color: var(--school-blue); margin: 0; font-size: 1.5rem; text-transform: uppercase; }
        .header p { font-weight: bold; color: #666; margin: 5px 0 15px 0; }

        .scoreboard {
            display: flex;
            justify-content: space-between;
            margin-bottom: 15px;
            gap: 10px;
        }

        .player-box {
            flex: 1;
            padding: 15px;
            border-radius: 12px;
            background: var(--light);
            border: 3px solid transparent;
            transition: 0.3s;
        }

        .player-box.active-p1 { border-color: var(--p1-color); background: #e8f8f0; transform: scale(1.05); }
        .player-box.active-p2 { border-color: var(--p2-color); background: #ebf5fb; transform: scale(1.05); }

        .score-val { font-size: 1.8rem; font-weight: bold; display: block; }
        .timer-display { font-size: 1.4rem; font-weight: bold; color: var(--danger); }

        .question-area {
            background: #fff;
            padding: 25px;
            border-radius: 15px;
            margin-bottom: 20px;
            min-height: 100px;
            box-shadow: inset 0 0 10px rgba(0,0,0,0.1);
            position: relative;
            display: flex;
            flex-direction: column;
            justify-content: center;
        }

        #question-text { font-size: 1.3rem; line-height: 1.4; font-weight: 600; }

        .input-group {
            display: flex;
            gap: 10px;
            justify-content: center;
            align-items: center;
            margin-bottom: 15px;
        }

        input[type="text"] {
            width: 50%;
            padding: 12px;
            font-size: 1.2rem;
            border: 2px solid #ddd;
            border-radius: 10px;
            text-align: center;
        }

        .mic-btn {
            background: #f1c40f;
            border: none;
            border-radius: 50%;
            width: 55px;
            height: 55px;
            cursor: pointer;
            font-size: 1.5rem;
            display: flex;
            align-items: center;
            justify-content: center;
            transition: 0.3s;
        }

        .mic-btn.listening {
            background: #e74c3c;
            color: white;
            animation: pulse 1s infinite;
        }

        @keyframes pulse {
            0% { transform: scale(1); box-shadow: 0 0 0 0 rgba(231, 76, 60, 0.7); }
            70% { transform: scale(1.1); box-shadow: 0 0 0 10px rgba(231, 76, 60, 0); }
            100% { transform: scale(1); box-shadow: 0 0 0 0 rgba(231, 76, 60, 0); }
        }

        .btn-group { display: flex; gap: 10px; margin-top: 10px; }
        .main-btn {
            flex: 1;
            padding: 15px;
            font-size: 1rem;
            font-weight: bold;
            border: none;
            border-radius: 10px;
            cursor: pointer;
            background: var(--school-blue);
            color: white;
        }

        #feedback { margin-top: 10px; font-weight: bold; height: 25px; font-size: 1.1rem; }
        .p1-text { color: var(--p1-color); }
        .p2-text { color: var(--p2-color); }
    </style>
</head>
<body>

<div class="game-container">
    <div class="header">
        <h1>ST MARY'S COLLEGE KWAMBA</h1>
        <p>Suleja, Niger State | Voice Math Duel</p>
    </div>

    <div class="scoreboard">
        <div id="p1-box" class="player-box">
            <span>PLAYER 1</span>
            <span id="p1-score" class="score-val">0</span>
        </div>
        <div class="timer-section">
            <div class="timer-display">‚è± <span id="timer">300</span>s</div>
        </div>
        <div id="p2-box" class="player-box">
            <span>PLAYER 2</span>
            <span id="p2-score" class="score-val">0</span>
        </div>
    </div>

    <div class="question-area">
        <div id="question-text">Ready for the New Topics? Press Start!</div>
    </div>

    <div class="input-group">
        <input type="text" id="answer-input" placeholder="Type or Speak..." disabled>
        <button id="mic-btn" class="mic-btn" title="Click and say answer">üé§</button>
    </div>
    
    <div class="btn-group">
        <button id="action-btn" class="main-btn">Start Game</button>
    </div>

    <div id="feedback"></div>
</div>

<script>
    let scores = [0, 0];
    let timeLeft = 300;
    let timer;
    let currentAnswer;
    let currentPlayer = 1;
    let isPlaying = false;

    const synth = window.speechSynthesis;
    const SpeechRecognition = window.SpeechRecognition || window.webkitSpeechRecognition;
    let recognition;
    
    if (SpeechRecognition) {
        recognition = new SpeechRecognition();
        recognition.continuous = false;
        recognition.lang = 'en-US';
    }

    const qText = document.getElementById('question-text');
    const input = document.getElementById('answer-input');
    const actionBtn = document.getElementById('action-btn');
    const micBtn = document.getElementById('mic-btn');
    const timerEl = document.getElementById('timer');
    const feedbackEl = document.getElementById('feedback');

    const helpers = {
        speak: (text) => {
            synth.cancel();
            const utter = new SpeechSynthesisUtterance(text);
            synth.speak(utter);
        },
        normalize: (str) => str.toLowerCase().replace(/[^0-9.a-z]/g, '')
    };

    function generateQuestion() {
        const topics = [
            'BaseConversion', 'FractionDecimal', 'SimplePercentage', 
            'RatioSharing', 'Equations', 'LinesAngles', 
            'SquareGeometry', 'WordProblems', 'Statistics'
        ];
        const topic = topics[Math.floor(Math.random() * topics.length)];
        let prompt = "";

        document.getElementById('p1-box').className = currentPlayer === 1 ? 'player-box active-p1' : 'player-box';
        document.getElementById('p2-box').className = currentPlayer === 2 ? 'player-box active-p2' : 'player-box';

        switch(topic) {
            case 'BaseConversion':
                const binary = ["10", "11", "101", "110", "111"][Math.floor(Math.random()*5)];
                prompt = `Convert binary number ${binary} to base 10.`;
                currentAnswer = parseInt(binary, 2).toString();
                break;

            case 'FractionDecimal':
                const fracs = [{q:"1/2", a:"0.5"}, {q:"1/4", a:"0.25"}, {q:"1/5", a:"0.2"}, {q:"2/5", a:"0.4"}, {q:"3/4", a:"0.75"}];
                const f = fracs[Math.floor(Math.random()*fracs.length)];
                prompt = `Convert the fraction ${f.q} to a decimal.`;
                currentAnswer = f.a;
                break;

            case 'SimplePercentage':
                const p = [10, 20, 25, 50][Math.floor(Math.random()*4)];
                const val = (Math.floor(Math.random()*10)+1)*100;
                prompt = `What is ${p} percent of ${val}?`;
                currentAnswer = ((p/100)*val).toString();
                break;

            case 'RatioSharing':
                const ratios = [{r1:2, r2:3, total:2000, ans:800}, {r1:1, r2:4, total:500, ans:100}, {r1:3, r2:2, total:1000, ans:600}];
                const rs = ratios[Math.floor(Math.random()*ratios.length)];
                prompt = `Share ${rs.total} in ratio ${rs.r1} to ${rs.r2}. What is the smaller share?`;
                currentAnswer = rs.ans.toString();
                break;

            case 'Equations':
                const xVal = Math.floor(Math.random()*15)+2;
                const offset = Math.floor(Math.random()*10)+1;
                prompt = `Solve for x: x plus ${offset} equals ${xVal + offset}.`;
                currentAnswer = xVal.toString();
                break;

            case 'LinesAngles':
                const angleTypes = [
                    {q:"How many degrees are in a straight line?", a:"180"},
                    {q:"How many degrees are in a right angle?", a:"90"},
                    {q:"Angles that sum to 90 degrees are called?", a:"complementary"},
                    {q:"Angles that sum to 180 degrees are called?", a:"supplementary"}
                ];
                const at = angleTypes[Math.floor(Math.random()*angleTypes.length)];
                prompt = at.q;
                currentAnswer = at.a;
                break;

            case 'SquareGeometry':
                const side = Math.floor(Math.random()*8)+3;
                const isArea = Math.random() > 0.5;
                prompt = isArea ? `What is the area of a square with side ${side}?` : `What is the perimeter of a square with side ${side}?`;
                currentAnswer = isArea ? (side*side).toString() : (side*4).toString();
                break;

            case 'WordProblems':
                const numA = Math.floor(Math.random()*20)+10;
                const numB = Math.floor(Math.random()*10)+5;
                prompt = `If Musa has ${numA} oranges and gives ${numB} to his brother, how many are left?`;
                currentAnswer = (numA - numB).toString();
                break;

            case 'Statistics':
                const stats = [
                    {q:"Find the median of 1, 3, and 5.", a:"3"},
                    {q:"Find the mean of 2, 4, and 6.", a:"4"},
                    {q:"In the set 2, 2, 3, 5, what is the mode?", a:"2"}
                ];
                const st = stats[Math.floor(Math.random()*stats.length)];
                prompt = st.q;
                currentAnswer = st.a;
                break;
        }

        qText.innerText = `PLAYER ${currentPlayer}: ${prompt}`;
        helpers.speak(`Player ${currentPlayer}, ${prompt}`);
    }

    function checkAnswer(val) {
        if(!isPlaying) return;
        if(helpers.normalize(val) === helpers.normalize(currentAnswer)) {
            scores[currentPlayer-1] += 10;
            feedbackEl.innerText = "Correct!";
            feedbackEl.className = currentPlayer === 1 ? 'p1-text' : 'p2-text';
        } else {
            feedbackEl.innerText = `Incorrect! Answer: ${currentAnswer}`;
            feedbackEl.className = 'wrong';
        }
        document.getElementById(`p${currentPlayer}-score`).innerText = scores[currentPlayer-1];
        currentPlayer = currentPlayer === 1 ? 2 : 1;
        input.value = '';
        generateQuestion();
    }

    micBtn.addEventListener('click', () => {
        if (!recognition || !isPlaying) return;
        recognition.start();
        micBtn.classList.add('listening');
    });

    if(recognition) {
        recognition.onresult = (e) => {
            const transcript = e.results[0][0].transcript;
            input.value = transcript;
            micBtn.classList.remove('listening');
            checkAnswer(transcript);
        };
    }

    function startGame() {
        scores = [0, 0]; timeLeft = 300; isPlaying = true; currentPlayer = 1;
        document.getElementById('p1-score').innerText = 0;
        document.getElementById('p2-score').innerText = 0;
        input.disabled = false;
        actionBtn.innerText = "Submit Answer";
        generateQuestion();
        timer = setInterval(() => {
            timeLeft--;
            timerEl.innerText = timeLeft;
            if(timeLeft <= 0) endGame();
        }, 1000);
    }

    function endGame() {
        clearInterval(timer);
        isPlaying = false;
        const winner = scores[0] > scores[1] ? "Player 1 Wins!" : (scores[1] > scores[0] ? "Player 2 Wins!" : "It's a Tie!");
        qText.innerText = `Time Up! ${winner}`;
        helpers.speak(`Game over. ${winner}`);
        actionBtn.innerText = "Restart Duel";
    }

    actionBtn.addEventListener('click', () => isPlaying ? checkAnswer(input.value) : startGame());
    input.addEventListener('keypress', (e) => { if(e.key === 'Enter') checkAnswer(input.value); });
</script>
</body>
    </html>

<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>St Mary's Voice Math Duel</title>
    <style>
        :root {
            --school-blue: #003366;
            --school-gold: #f1c40f;
            --p1-color: #2ecc71;
            --p2-color: #3498db;
            --danger: #e74c3c;
            --light: #f4f7f6;
        }

        body {
            font-family: 'Segoe UI', sans-serif;
            background: linear-gradient(135deg, #003366, #00509d);
            display: flex;
            justify-content: center;
            align-items: center;
            min-height: 100vh;
            margin: 0;
            color: #2c3e50;
        }

        .game-container {
            background: white;
            padding: 30px;
            border-radius: 20px;
            box-shadow: 0 20px 50px rgba(0,0,0,0.4);
            width: 95%;
            max-width: 750px;
            text-align: center;
            border: 6px solid var(--school-gold);
        }

        .header h1 { color: var(--school-blue); margin: 0; font-size: 1.5rem; text-transform: uppercase; }
        .header p { font-weight: bold; color: #666; margin: 5px 0 15px 0; }

        .scoreboard {
            display: flex;
            justify-content: space-between;
            margin-bottom: 15px;
            gap: 10px;
        }

        .player-box {
            flex: 1;
            padding: 15px;
            border-radius: 12px;
            background: var(--light);
            border: 3px solid transparent;
            transition: 0.3s;
        }

        .player-box.active-p1 { border-color: var(--p1-color); background: #e8f8f0; transform: scale(1.05); }
        .player-box.active-p2 { border-color: var(--p2-color); background: #ebf5fb; transform: scale(1.05); }

        .score-val { font-size: 1.8rem; font-weight: bold; display: block; }
        .timer-display { font-size: 1.2rem; font-weight: bold; color: var(--school-blue); }
        .turn-timer { color: var(--danger); font-size: 1.5rem; display: block; margin-top: 5px; }

        .question-area {
            background: #fff;
            padding: 25px;
            border-radius: 15px;
            margin-bottom: 20px;
            min-height: 100px;
            box-shadow: inset 0 0 10px rgba(0,0,0,0.1);
            position: relative;
            display: flex;
            flex-direction: column;
            justify-content: center;
        }

        #question-text { font-size: 1.3rem; line-height: 1.4; font-weight: 600; }

        .input-group {
            display: flex;
            gap: 10px;
            justify-content: center;
            align-items: center;
            margin-bottom: 15px;
        }

        input[type="text"] {
            width: 50%;
            padding: 12px;
            font-size: 1.2rem;
            border: 2px solid #ddd;
            border-radius: 10px;
            text-align: center;
        }

        .mic-btn {
            background: #f1c40f;
            border: none;
            border-radius: 50%;
            width: 55px;
            height: 55px;
            cursor: pointer;
            font-size: 1.5rem;
            display: flex;
            align-items: center;
            justify-content: center;
            transition: 0.3s;
        }

        .mic-btn.listening {
            background: #e74c3c;
            color: white;
            animation: pulse 1s infinite;
        }

        @keyframes pulse {
            0% { transform: scale(1); box-shadow: 0 0 0 0 rgba(231, 76, 60, 0.7); }
            70% { transform: scale(1.1); box-shadow: 0 0 0 10px rgba(231, 76, 60, 0); }
            100% { transform: scale(1); box-shadow: 0 0 0 0 rgba(231, 76, 60, 0); }
        }

        .btn-group { display: flex; gap: 10px; margin-top: 10px; }
        .main-btn {
            flex: 1;
            padding: 15px;
            font-size: 1rem;
            font-weight: bold;
            border: none;
            border-radius: 10px;
            cursor: pointer;
            background: var(--school-blue);
            color: white;
        }

        #feedback { margin-top: 10px; font-weight: bold; height: 25px; font-size: 1.1rem; }
        .p1-text { color: var(--p1-color); }
        .p2-text { color: var(--p2-color); }
    </style>
</head>
<body>

<div class="game-container">
    <div class="header">
        <h1>ST MARY'S COLLEGE KWAMBA</h1>
        <p>Suleja, Niger State | Voice Math Duel</p>
    </div>

    <div class="scoreboard">
        <div id="p1-box" class="player-box">
            <span>PLAYER 1</span>
            <span id="p1-score" class="score-val">0</span>
        </div>
        <div class="timer-section">
            <div class="timer-display">TOTAL: <span id="timer">600</span>s</div>
            <div class="turn-timer">TURN: <span id="turn-clock">60</span>s</div>
        </div>
        <div id="p2-box" class="player-box">
            <span>PLAYER 2</span>
            <span id="p2-score" class="score-val">0</span>
        </div>
    </div>

    <div class="question-area">
        <div id="question-text">Ready? Enable Mic & Press Start!</div>
    </div>

    <div class="input-group">
        <input type="text" id="answer-input" placeholder="Type or Speak..." disabled>
        <button id="mic-btn" class="mic-btn" title="Click and say answer">ðŸŽ¤</button>
    </div>
    
    <div class="btn-group">
        <button id="action-btn" class="main-btn">Start Game</button>
    </div>

    <div id="feedback"></div>
</div>

<script>
    let scores = [0, 0];
    let totalTime = 600;
    let turnTime = 60;
    let gameInterval;
    let currentAnswer;
    let currentPlayer = 1;
    let isPlaying = false;

    const synth = window.speechSynthesis;
    const SpeechRecognition = window.SpeechRecognition || window.webkitSpeechRecognition;
    let recognition;
    
    if (SpeechRecognition) {
        recognition = new SpeechRecognition();
        recognition.continuous = false;
        recognition.lang = 'en-US';
    }

    const qText = document.getElementById('question-text');
    const input = document.getElementById('answer-input');
    const actionBtn = document.getElementById('action-btn');
    const micBtn = document.getElementById('mic-btn');
    const timerEl = document.getElementById('timer');
    const turnClockEl = document.getElementById('turn-clock');
    const feedbackEl = document.getElementById('feedback');

    const helpers = {
        gcd: (a, b) => b === 0 ? a : helpers.gcd(b, a % b),
        lcm: (a, b) => (a * b) / helpers.gcd(a, b),
        speak: (text) => {
            synth.cancel();
            const utter = new SpeechSynthesisUtterance(text);
            synth.speak(utter);
        },
        normalize: (str) => {
            return str.toLowerCase()
                .replace(/ naira/g, '')
                .replace(/ apples/g, '')
                .replace(/ to /g, ':')
                .replace(/[^0-9/:a-z]/g, '');
        }
    };

    function generateQuestion() {
        const categories = ['FracSimplify', 'FracMath', 'RatioShare', 'Volume', 'Triangles', 'LCM_HCF', 'Percentage'];
        const category = categories[Math.floor(Math.random() * categories.length)];
        let prompt = "";
        turnTime = 60; // Reset turn clock
        turnClockEl.innerText = turnTime;

        document.getElementById('p1-box').className = currentPlayer === 1 ? 'player-box active-p1' : 'player-box';
        document.getElementById('p2-box').className = currentPlayer === 2 ? 'player-box active-p2' : 'player-box';

        switch(category) {
            case 'FracSimplify':
                const num = 8, den = 12; // Example simplified 2/3
                const mult = Math.floor(Math.random()*4)+2;
                prompt = `Simplify the fraction ${num*mult} over ${den*mult}.`;
                currentAnswer = "2/3";
                break;

            case 'FracMath':
                const ops = ['plus', 'times'];
                const op = ops[Math.floor(Math.random()*ops.length)];
                prompt = op === 'plus' ? `What is 1/2 plus 1/4?` : `What is 2/3 times 3/4?`;
                currentAnswer = op === 'plus' ? "3/4" : "1/2";
                break;

            case 'RatioShare':
                const rType = Math.random();
                if(rType < 0.5) {
                    prompt = "Share 2000 Naira in the ratio of 2 to 3. What is the smaller share?";
                    currentAnswer = "800";
                } else {
                    prompt = "Musa and Ada shared 12 apples in ratio 2 to 4. What is Musa's share?";
                    currentAnswer = "4";
                }
                break;

            case 'Volume':
                if(Math.random() > 0.5) {
                    const s = Math.floor(Math.random()*3)+3;
                    prompt = `Find the volume of a cube with side ${s} cm.`;
                    currentAnswer = (s*s*s).toString();
                } else {
                    prompt = "Find the volume of a cuboid with length 5, width 2, and height 3.";
                    currentAnswer = "30";
                }
                break;

            case 'Triangles':
                const tType = Math.random();
                if(tType < 0.3) {
                    prompt = "What is a triangle with two equal sides called?";
                    currentAnswer = "isosceles";
                } else if (tType < 0.6) {
                    prompt = "Find the third angle of a triangle if two angles are 60 and 70 degrees.";
                    currentAnswer = "50";
                } else {
                    prompt = "What is the sum of angles in a triangle?";
                    currentAnswer = "180";
                }
                break;

            case 'LCM_HCF':
                const isLCM = Math.random() > 0.5;
                prompt = `Find the ${isLCM ? 'LCM' : 'HCF'} of 12 and 8.`;
                currentAnswer = isLCM ? "24" : "4";
                break;

            case 'Percentage':
                prompt = "What is 25 percent of 80?";
                currentAnswer = "20";
                break;
        }

        qText.innerText = `PLAYER ${currentPlayer}: ${prompt}`;
        helpers.speak(`Player ${currentPlayer}, ${prompt}`);
    }

    function checkAnswer(val) {
        if(!isPlaying) return;
        const u = helpers.normalize(val);
        const c = helpers.normalize(currentAnswer);

        if(u === c) {
            scores[currentPlayer-1] += 10;
            feedbackEl.innerText = "Correct! +10";
            feedbackEl.className = currentPlayer === 1 ? 'p1-text' : 'p2-text';
        } else {
            feedbackEl.innerText = `Wrong! Answer was ${currentAnswer}`;
            feedbackEl.className = 'wrong';
        }
        
        document.getElementById(`p${currentPlayer}-score`).innerText = scores[currentPlayer-1];
        nextTurn();
    }

    function nextTurn() {
        currentPlayer = currentPlayer === 1 ? 2 : 1;
        input.value = '';
        generateQuestion();
    }

    micBtn.addEventListener('click', () => {
        if (!recognition || !isPlaying) return;
        recognition.start();
        micBtn.classList.add('listening');
    });

    if(recognition) {
        recognition.onresult = (e) => {
            const transcript = e.results[0][0].transcript;
            input.value = transcript;
            micBtn.classList.remove('listening');
            checkAnswer(transcript);
        };
        recognition.onerror = () => micBtn.classList.remove('listening');
    }

    function startGame() {
        scores = [0, 0]; totalTime = 600; turnTime = 60; isPlaying = true; currentPlayer = 1;
        document.getElementById('p1-score').innerText = 0;
        document.getElementById('p2-score').innerText = 0;
        input.disabled = false;
        actionBtn.innerText = "Submit";
        generateQuestion();
        
        gameInterval = setInterval(() => {
            totalTime--;
            turnTime--;
            timerEl.innerText = totalTime;
            turnClockEl.innerText = turnTime;

            if(turnTime <= 0) {
                feedbackEl.innerText = "Time out! Passing turn...";
                feedbackEl.className = "wrong";
                nextTurn();
            }

            if(totalTime <= 0) endGame();
        }, 1000);
    }

    function endGame() {
        clearInterval(gameInterval);
        isPlaying = false;
        input.disabled = true;
        const winner = scores[0] > scores[1] ? "Player 1 Wins!" : (scores[1] > scores[0] ? "Player 2 Wins!" : "Tie!");
        qText.innerText = `Duel Over! ${winner}`;
        helpers.speak(`Game over. ${winner}`);
        actionBtn.innerText = "Restart Duel";
    }

    actionBtn.addEventListener('click', () => isPlaying ? checkAnswer(input.value) : startGame());
    input.addEventListener('keypress', (e) => { if(e.key === 'Enter') checkAnswer(input.value); });
</script>
</body>
    </html>
